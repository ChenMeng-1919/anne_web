<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ElementUi</title>
    <!-- 引入样式 -->
    <!--绝对路径，项目启动后可以访问-->
    <link rel="stylesheet" href="/css/elementui.css">
    <script src="/js/vue.js"></script>
    <script src="/js/elementui.js"></script>
    <script src="/js/axios.min.js"></script>
    <script src="/js/vue-router.js"></script>
</head>
<body>
<div id="app">
    <h1>Hello !</h1>
    <p>
        <!-- 使用 router-link 组件来导航. -->
        <!-- 通过传入 `to` 属性指定链接. -->
        <!-- <router-link> 默认会被渲染成一个 `<a>` 标签 -->
        <router-link to="/hash1">切换至com1</router-link>
        <router-link to="/hash2">切换至com2</router-link>
    </p>
    <!-- 路由出口 -->
    <!-- 路由匹配到的组件将渲染在这里 -->
    <router-view></router-view>
    <!-- router-link上的其他属性： -->
    <!-- 设置 replace 属性的话，当点击时，会调用 router.replace() 而不是 router.push()，
        导航后不会留下 history 记录。 -->
    <!-- <router-link :to="{ path: '/abc'}" replace></router-link> -->
    <!-- 有时候想要 <router-link> 渲染成某种标签，例如 <li>。 于是我们使用
     tag prop 类指定何种标签，同样它还是会监听点击，触发导航。 -->
    <!-- <router-link to="/foo" tag="li">foo</router-link> -->
    <!-- active-class 设置 链接激活时使用的 CSS  -->
    <!-- event 声明可以用来触发导航的事件。可以是一个字符串或是一个包含字符串的数组。 -->

    <el-row>
        <el-col :offset="10">
            <h1 style="color: #3a8ee6">管会月结数据核对</h1>
        </el-col>
    </el-row>
    <el-row>
        <el-col :span="8" :offset="10">
            <div style="width: 100%;">
                <el-select v-model="selectValue" filterable placeholder="请选择" clearable>
                    <el-option
                            v-for="item in options"
                            :key="item.value"
                            :label="item.label"
                            :value="item.value">
                    </el-option>
                </el-select>
            </div>
        </el-col>
    </el-row>
    <el-row>
        <el-col :span="8" :offset="10">
            <el-upload
                    class="upload-demo"
                    :action="selectValue"
                    :on-preview="handlePreview"
                    :on-remove="handleRemove"
                    :before-remove="beforeRemove"
                    :limit="1"
                    :on-exceed="handleExceed"
                    :file-list="fileList"
                    mul
                    :on-success="successdo"
                    style="width: 100%;">
                <el-button size="small" type="primary" style=" margin-top: 20px">点击上传</el-button>
                <div slot="tip" class="el-upload__tip">上传excel数据源</div>
            </el-upload>
        </el-col>
    </el-row>
    <router-view></router-view>

</div>
</body>

<script>
    // 1. 定义（路由）组件。
    const com1 = {template: '<div>路由1</div>'}
    const com2 = {template: '<div>路由2</div>'}

    // 2. 定义路由
    // 每个路由应该映射一个组件。 其中"component" 可以是 通过 Vue.extend()
    //  创建的组件构造器， 或者，只是一个组件配置对象.
    const routes = [
        {path: '/hash1', component: com1},
        {path: '/hash2', component: com2}
    ]

    // 3. 创建 router 实例，然后传 `routes` 配置
    const router = new VueRouter({
        routes // （缩写）相当于 routes: routes
    })

    // 4. 创建和挂载根实例。
    // 要通过 router 配置参数注入路由，从而让整个应用都有路由功能

    //创建路由对象并定义路由规则
    const router = new VueRouter({
        routes: [
            {path: '/loadfile', component: loadfile}, //用来定义具体的某个组件路由规则  path: 用来指定对应请求路径  component:指定路径对应的组件
            {path: '/emps', component: emps}
        ] //用来定义一些列规则
    });
    var vm = new Vue({
        el: "#app",
        data() {
            return {
                options: [{
                    value: '/uploadCheckOrg',
                    label: '机构核对'
                }, {
                    value: '/uploadcheckCBZX',
                    label: '成本中心核对'
                }, {
                    value: '/uploadcheckCBZXSX',
                    label: '成本中心属性核对'
                }, {
                    value: '/checkAccount',
                    label: '新科目核对'
                }, {
                    value: '/filterAccount',
                    label: '新科目核对结果过滤'
                }, {
                    value: '/addAccount',
                    label: '新增科目核对'
                }, {
                    value: '/addProd',
                    label: '新增产品核对'
                }, {
                    value: '/mtobCheck',
                    label: '总分核对'
                }, {
                    value: '/uploadcheckAccountProductMapping',
                    label: '科目产品映射'
                }, {
                    value: '/uploadcheckAccountLobMapping',
                    label: '科目条线映射'
                }, {
                    value: '/uploadcheckCBZXSX',
                    label: '源系统产品映射'
                }, {
                    value: '/uploadcheckCBZXSX',
                    label: '源系统条线映射'
                }, {
                    value: '/orgChange',
                    label: '机构变更'
                }],
                selectValue: '',
                fileList: [],
                fileUUID: '',
                router: router,//用来注册路由配置
            }

        },
        methods: {

            handleRemove(file, fileList) {
                console.log(file, fileList);
            },
            handlePreview(file) {
                console.log(file);
            },
            handleExceed(files, fileList) {
                this.$message.warning(`当前限制选择 1 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`);
            },
            beforeRemove(file, fileList) {
                return this.$confirm(`确定移除 ${file.name}？`);
            },
            successdo(response, file, fileList) {
                this.fileUUID = response;
                console.log(this.fileUUID)

                axios({
                    method: "get",
                    url: "http://localhost:8080/getFileById",
                    params: {
                        fileUUID: this.fileUUID
                    },
                    /*data: this.fileUUID,*/
                    responseType: 'blob'
                }).then(res => {
                    const fileName = res.headers['content-disposition'].match(
                        /filename=(.*)/
                    )[1]
                    console.log(res)
                    console.log(res.headers)
                    var blob = new Blob([res.data], {type: "application/octet-stream"});
                    if (window.navigator.msSaveOrOpenBlob) {//msSaveOrOpenBlob方法返回bool值
                        navigator.msSaveBlob(blob, decodeURI(fileName));//本地保存
                    } else {
                        var link = document.createElement('a');//a标签下载
                        link.href = window.URL.createObjectURL(blob);
                        link.download = decodeURI(fileName);
                        link.click();
                        window.URL.revokeObjectURL(link.href);
                    }
                });
            }
        }
    })
</script>
</html>